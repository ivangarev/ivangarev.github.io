
   Просмотрел все статьи SergUA6 по части OFDM и OCG за период 
октябрь 2007 - март 2008. Возникли кое-какие поправки и дополнения.
   1.Об ортогональности я уже писал на форуме. Если под 
ортогональностью понимать свойство,позволяющее полностью разделить 
манипулированные частотные подканалы на приеме, то для ортого-
нальности необходима связь между интервалом обработки сигнала 
в демодуляторе и расстоянием между поднесущими (и с самими их значениями).Бодовая скорость может быть  л ю б о й, еще раз -
л ю б о й,  не большей расстояния между поднесущими (все в Герцах). Разумеется, что амплитуды и фазы сигналов в подканалах должны 
быть на интервале обработки постоянными, а манипуляция в 
подканалах одновременной. 
   2.Размывание частот из-за "циклического префикса", а по нашему
-защитного интервала - возникает, по-видимому, в тех 
спектроанализаторах, какими пока пользуются наблюдатели. На всех
просмотренных мною спектрах я не видел ни одного чисто линейчатого 
с практически нулевыми межчастотными интервалами, то есть такого,
какой виртуально создается в демодуляторе. И с пилот-сигналами 
все ОК. Ведь они же такие же поднесущие, как подканальные частоты,
и если они манипулируются по фазе или амплитуде, то одновременно
с подканалами. 
   3.Синтез сигналов OFDM, похожих на сигналы реальных модемов - это замечательно. Попробую изложить эту процедуру попроще на двух
примерах. Все недавно проверил на компе еще раз.  
   АТ-3004Д - 12 каналов через 200 Гц, первый на 700 Гц,
последний на 2900, бодовая скорость 120 (про пилот забыли).
Опорной частотой является 100Гц, а подканальные частоты - 
ее нечетные гармоники. Частота дискретизации должна быть
кратна и 100 и 120, иначе не сформировать длительность бода.
Возможные ее значения 7200Гц, 8400Гц и т.д. 
   Выберем 8400.Получим интервал дискретизации 1/8400. Для 
формирования бода нужны 8400/120 = 70 точек (из 84-х), 
при расчете каждой из 70 временных выборок надо просуммировать 
только 12 компонент (по одной от каждого подканала). 
   Для моделирования одного бода этого достаточно. Если нужна последовательность неманипулированных бодов, то необходимо
циклически продолжать расчет временных выборок. Особо нужно
обратить внимание на отсутствие разрывов сигнала на границах
бодов. Если нужна манипуляция, то перед расчетом 71, 141 и т.д.
выборок надо вводить манипуляционный сдвиг фазы.
   Мой родной МС-5 - 20 каналов через 142 Гц, первый на 497 Гц, 
последний на 3195, бодовая скорость 120. Опорная частота - 71 Гц, а 
подканальные частоты - ее нечетные гармоники. Возможные значения
частоты дискретизации 8520Гц, 17040Гц и т.д. При выборе 8520
для формирования бода необходимы 71 (из 120) точек, при расчете 
каждой из них надо учесть 20 компонент.
   Маленькое примечание. В обоих модемах частоты подканалов есть 
нечетные гармоники опорной частоты. Возможен и вариант с четными 
гармониками. 
   4.Как моделировать? Я не пользуюсь готовым софтом, выполняющим
БПФ, по нескольким причинам. У меня нет опыта работы с таким 
софтом и потому нет к нему расположения. Хочу напомнить, что
сам Фурье предложил аппроксимацию функций тригонометрическими 
рядами. Потом его результаты были развиты на комплексную плоскость.
Но часто развития и обобщения таят подводные камни. В нашем случае, 
чтобы получить нормальный (действительный) выходной сигнал 
модулятора в результате обратного дискретного преобразования 
необходимо каждую реальную частотную компоненту представлять
суммой двух комплексно-сопряженных и если все сделать корректно, 
то все мнимости в ходе расчета должны компенсироваться. 
Зачем же их считать?
   Я пользуюсь обычными тригонометрическими формулами. С их 
помощью я еще десять лет назад смог на среднем по тем годам 
компе с платой расширения L-card демодулировать сигнал 
реального АТ-3004Д. Разработка софта дело простое. Я по старинке
использую турбо-паскаль 6-ой версии.
   5.Моделирование сигнала позволяет глубже понять специфику
OFDM. Но многих наверное интересует только анализ сигналов из эфира.
И чем глубже этот анализ, тем, вероятно, лучше. Что для этого надо?
    а)выбрать частоту дискретизации и количество точек преобразования
по Фурье таким же образом, как в п.3,
    б)иметь программную реализацию алгоритма прямого преобразования 
Фурье. Для экономии времени хорошо, если эта программа может 
отсеять ненужные для расчета точки (реально не используемые частоты).
Если при моделировании вычисляются Fдискретизации/Fбодовая точек, то
при анализе - Fдискретизации/Fразноса точек. Если хотите демоду-
лировать в реальном масштабе времени, то цикл расчетов должен 
выполняться за время меньшее бодовой длительности,
    в)необходимо иметь подпрограмму синхронизации для определения
момента запуска программы анализа. Вот это, по моему, не выполнялось 
при снятии виденных мною спектров. Момент запуска может быть 
определен либо по пилот-тонам (обычно они АМ), либо по спектральным 
"дыркам" - наследие очень старых модемов, либо, что сложнее всего, непосредственно по принимаемому сигналу (если в нем не содержится 
каких-либо пилотов или "дырок" - так было в "МС-5"). По пилоту проще 
всего. По "дыркам" - сдвигая начало анализа, надо искать минимум 
в них сигнала. 
   6.В результате п.5 получите два отсчета на одну частоту -
синфазную и квадратурную компоненты. Можете вычислить амплитуды и
смотреть линейчатый спектр с чистыми, чуть зашумленными (если 
помеха слабая) участками между поднесущими. Можете определить 
разность фаз между соседними посылками и пр. и мн. другое.
   Маленькое примечание. Если попытаетесь демодулировать до битов - необходимо перед каждым запуском алгоритма анализа корректировать
предыдущие значения фаз в частотных подканалах на величину, 
зависящую от различия опорной и бодовой частот. Величина фазовой 
поправки равна

       alfa=2*PI*(1-Fопорн./Fбодов.)*Fканала/Fопорн.

   Вот и вся премудрость. Желаю удачи. Дерзайте други. С вопросами
на форум "Модемы на КВ".